import"./main-vhD-KP9M.js";import{T as p}from"./theme-manager-CdLvXRPk.js";class g{constructor(){this.themeManager=new p,this.init()}init(){this.renderBoardThemes(),this.renderPieceSets(),this.loadBoardOrientation(),this.loadShowHints(),this.setupEventListeners(),this.setupAppManagement()}loadBoardOrientation(){const e=document.getElementById("board-orientation-select");if(e){const t=localStorage.getItem("mate-board-orientation")||"bottom";e.value=t}}loadShowHints(){const e=document.getElementById("show-hints-toggle");if(e){const t=localStorage.getItem("mate-show-hints");e.checked=t==="true"||t===null}}renderBoardThemes(){const e=document.getElementById("board-themes"),t=this.themeManager.getBoardThemes(),a=this.themeManager.currentBoardTheme;e.innerHTML="",Object.entries(t).forEach(([n,i])=>{const s=document.createElement("div");s.className="theme-option",s.dataset.themeId=n,n===a&&s.classList.add("selected");const o=document.createElement("div");o.className="theme-preview";for(let d=0;d<8;d++){const c=document.createElement("div");c.className="preview-square",c.style.backgroundColor=d%2===0?i.light:i.dark,o.appendChild(c)}s.appendChild(o);const l=document.createElement("h3");l.textContent=i.name,s.appendChild(l);const r=document.createElement("p");r.textContent=i.description,s.appendChild(r),e.appendChild(s)})}renderPieceSets(){const e=document.getElementById("piece-sets"),t=this.themeManager.getPieceSets(),a=this.themeManager.currentPieceSet;e.innerHTML="",Object.entries(t).forEach(([n,i])=>{const s=document.createElement("div");s.className="theme-option",s.dataset.setId=n,n===a&&s.classList.add("selected");const o=document.createElement("div");o.className="piece-preview",o.style.color=i.style.whiteColor,o.style.textShadow=`0 0 2px ${i.style.whiteShadow}`,i.style.glow&&(o.style.filter=`drop-shadow(0 0 4px ${i.style.whiteColor})`),o.textContent=`${i.pieces.wK} ${i.pieces.wQ} ${i.pieces.wN}`,s.appendChild(o);const l=document.createElement("h3");l.textContent=i.name,s.appendChild(l);const r=document.createElement("p");r.textContent=i.description,s.appendChild(r),e.appendChild(s)})}setupEventListeners(){var e,t;document.getElementById("board-themes").addEventListener("click",a=>{const n=a.target.closest(".theme-option");if(n){const i=n.dataset.themeId;this.themeManager.setBoardTheme(i),this.renderBoardThemes(),this.showNotification(`Board theme changed to ${this.themeManager.getCurrentBoardTheme().name}`)}}),document.getElementById("piece-sets").addEventListener("click",a=>{const n=a.target.closest(".theme-option");if(n){const i=n.dataset.setId;this.themeManager.setPieceSet(i),this.renderPieceSets(),this.showNotification(`Piece set changed to ${this.themeManager.getCurrentPieceSet().name}`)}}),(e=document.getElementById("board-orientation-select"))==null||e.addEventListener("change",a=>{const n=a.target.value;localStorage.setItem("mate-board-orientation",n),this.showNotification(`Board orientation: ${n==="bottom"?"White on bottom":"Black on bottom"}`)}),(t=document.getElementById("show-hints-toggle"))==null||t.addEventListener("change",a=>{const n=a.target.checked;localStorage.setItem("mate-show-hints",n.toString()),this.showNotification(`Move hints: ${n?"Enabled âœ¨":"Disabled"}`)})}setupAppManagement(){var e,t;this.setupPWAInstall(),(e=document.getElementById("clear-saved-game-button"))==null||e.addEventListener("click",()=>{confirm("Clear your currently saved game? This cannot be undone.")&&(localStorage.removeItem("mate-current-game"),this.showNotification("âœ… Saved game cleared!"))}),(t=document.getElementById("clear-cache-button"))==null||t.addEventListener("click",async()=>{confirm("Clear all caches and reset service worker? The page will reload.")&&await this.clearCacheAndSW()}),this.loadVersionInfo()}setupPWAInstall(){const e=document.getElementById("pwa-install-button"),t=document.getElementById("install-status");if(!e)return;if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0){e.classList.add("installed"),t&&(t.textContent="Installed!"),e.disabled=!0;return}let n=null;window.addEventListener("beforeinstallprompt",i=>{console.log("[Settings] Install prompt available"),i.preventDefault(),n=i,t&&(t.textContent="Ready to install")}),e.addEventListener("click",async()=>{if(!n){this.showNotification("âš ï¸ Install not available. Try adding to home screen manually.");return}n.prompt();const{outcome:i}=await n.userChoice;i==="accepted"?(this.showNotification("âœ… Installing Mate..."),e.classList.add("installed"),t&&(t.textContent="Installed!"),e.disabled=!0):this.showNotification("Installation cancelled"),n=null}),window.addEventListener("appinstalled",()=>{console.log("[Settings] App installed successfully"),e.classList.add("installed"),t&&(t.textContent="Installed!"),e.disabled=!0,this.showNotification("âœ… Mate installed successfully!")})}async clearCacheAndSW(){try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(t=>caches.delete(t))),console.log("[Settings] All caches cleared")}if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map(t=>t.unregister())),console.log("[Settings] All service workers unregistered")}this.showNotification("âœ… Cache cleared! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(e){console.error("[Settings] Error clearing cache:",e),this.showNotification("âŒ Error clearing cache")}}async loadVersionInfo(){const e=document.getElementById("version-display"),t=document.getElementById("build-info");if(e)try{const a=await fetch("/build-info.json");if(a.ok){const n=await a.json();e.textContent=`Version ${n.version}`,t&&(t.textContent=`Build: ${new Date(n.buildTime).toLocaleString()}`)}else e.textContent="Version 1.0.0",t&&(t.textContent="Build: Development")}catch{e.textContent="Version 1.0.0",t&&(t.textContent="Build: Development")}}showNotification(e){const t=document.createElement("div");t.textContent=e,t.style.cssText=`
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 10000;
      animation: slideUp 0.3s ease;
    `,document.body.appendChild(t),setTimeout(()=>{t.style.animation="fadeOut 0.3s ease",setTimeout(()=>t.remove(),300)},2e3)}}document.addEventListener("DOMContentLoaded",()=>{new g});const h=document.createElement("style");h.textContent=`
  @keyframes slideUp {
    from {
      transform: translateX(-50%) translateY(100px);
      opacity: 0;
    }
    to {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  }
  
  @keyframes fadeOut {
    to {
      opacity: 0;
    }
  }
`;document.head.appendChild(h);class m{constructor(){this.deferredPrompt=null,this.isOnline=navigator.onLine,this.updateAvailable=!1,this.init()}init(){this.setupInstallPrompt(),this.setupOfflineDetection(),this.setupServiceWorkerUpdates(),this.showInstallBanner()}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{console.log("[PWA] Install prompt available"),e.preventDefault(),this.deferredPrompt=e,this.showInstallButton()}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App installed successfully!"),this.deferredPrompt=null,this.hideInstallButton(),this.showNotification("âœ… Mate installed! Launch from home screen."),this.trackEvent("pwa_installed")})}showInstallButton(){const e=document.getElementById("install-btn");e&&(e.style.display="block",e.addEventListener("click",()=>this.promptInstall(),{once:!0})),this.showInstallBanner()}hideInstallButton(){const e=document.getElementById("install-btn");e&&(e.style.display="none"),this.hideInstallBanner()}showInstallBanner(){var a,n;if(this.isStandalone())return;const e=localStorage.getItem("install-banner-dismissed");if(e&&Date.now()-parseInt(e)<7*24*60*60*1e3||!window.location.pathname.includes("index.html")&&window.location.pathname!=="/")return;const t=document.createElement("div");t.id="install-banner",t.className="install-banner",t.innerHTML=`
      <div class="install-banner-content">
        <span>ðŸ“± Install Mate for offline play!</span>
        <div class="install-banner-actions">
          <button id="install-banner-btn" class="btn-link">Install</button>
          <button id="install-banner-dismiss" class="btn-link">Ã—</button>
        </div>
      </div>
    `,document.body.appendChild(t),(a=document.getElementById("install-banner-btn"))==null||a.addEventListener("click",()=>{this.promptInstall(),t.remove()}),(n=document.getElementById("install-banner-dismiss"))==null||n.addEventListener("click",()=>{localStorage.setItem("install-banner-dismissed",Date.now().toString()),t.remove()}),setTimeout(()=>{t.parentNode&&t.remove()},1e4)}hideInstallBanner(){const e=document.getElementById("install-banner");e&&e.remove()}async promptInstall(){if(!this.deferredPrompt)return console.log("[PWA] No install prompt available"),!1;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;return console.log(`[PWA] User choice: ${e}`),e==="accepted"?(this.showNotification("ðŸ“² Installing Mate..."),this.trackEvent("pwa_install_accepted")):this.trackEvent("pwa_install_dismissed"),this.deferredPrompt=null,e==="accepted"}isStandalone(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")}setupOfflineDetection(){this.updateOnlineStatus(),window.addEventListener("online",()=>{this.isOnline=!0,this.updateOnlineStatus(),this.showNotification("âœ… Back online!","success",3e3),console.log("[PWA] Connection restored")}),window.addEventListener("offline",()=>{this.isOnline=!1,this.updateOnlineStatus(),this.showNotification("ðŸ“µ Offline mode - changes saved locally","info",5e3),console.log("[PWA] Connection lost")})}updateOnlineStatus(){document.body.classList.toggle("offline",!this.isOnline),document.body.classList.toggle("online",this.isOnline);let e=document.getElementById("online-status");e||(e=document.createElement("div"),e.id="online-status",e.className="online-status",document.body.appendChild(e)),e.className=`online-status ${this.isOnline?"online":"offline"}`,e.textContent=this.isOnline?"ðŸŸ¢":"ðŸ”´",e.title=this.isOnline?"Online":"Offline",this.isOnline?setTimeout(()=>{e.classList.add("fade-out")},3e3):e.classList.remove("fade-out")}setupServiceWorkerUpdates(){"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("[PWA] Service worker updated"),this.updateAvailable=!0,this.showUpdateBanner()}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&e.data.type==="SW_UPDATED"&&(console.log("[PWA] New version available:",e.data.version),this.updateAvailable=!0,this.showUpdateBanner())}),setInterval(()=>{this.checkForUpdates()},30*60*1e3))}async checkForUpdates(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration();e&&(await e.update(),console.log("[PWA] Checked for updates"))}catch(e){console.error("[PWA] Update check failed:",e)}}showUpdateBanner(){var t,a;if(document.getElementById("update-banner"))return;const e=document.createElement("div");e.id="update-banner",e.className="update-banner",e.innerHTML=`
      <div class="update-banner-content">
        <span>ðŸŽ‰ New version available!</span>
        <div class="update-banner-actions">
          <button id="update-reload-btn" class="btn-link">Update Now</button>
          <button id="update-later-btn" class="btn-link">Later</button>
        </div>
      </div>
    `,document.body.appendChild(e),(t=document.getElementById("update-reload-btn"))==null||t.addEventListener("click",()=>{window.location.reload()}),(a=document.getElementById("update-later-btn"))==null||a.addEventListener("click",()=>{e.remove()})}showNotification(e,t="info",a=3e3){const n=document.getElementById("game-status");n&&(n.textContent=e,n.className=`game-status notification-${t}`,a>0&&setTimeout(()=>{n.textContent===e&&(n.textContent="",n.className="game-status")},a))}trackEvent(e,t={}){console.log("[PWA] Event:",e,t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.pwaManager=new m}):window.pwaManager=new m;
